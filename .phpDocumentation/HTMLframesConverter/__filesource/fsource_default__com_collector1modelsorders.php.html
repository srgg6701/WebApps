<?xml version="1.0" encoding="iso-8859-1"?>
<!DOCTYPE html 
     PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
     "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
   <html xmlns="http://www.w3.org/1999/xhtml">
<head>
  <title>File Source for orders.php</title>
  <link rel="stylesheet" href="../media/stylesheet.css" />
<!-- template designed by Julien Damon based on PHPEdit's generated templates, and tweaked by Greg Beaver -->
<body bgcolor="#ffffff" ><h1 align="center">Source for file orders.php</h1>
<p>Documentation is available at <a href="../default/_com_collector1---models---orders.php.html">orders.php</a></p>
<div class="src-code">
<div class="src-code"><ol><li><div class="src-line"><a name="a1"></a><strong>&lt;?</strong></div></li>
<li><div class="src-line"><a name="a2"></a><a href="http://www.php.net/defined">defined</a><strong>(</strong><font color="#66cccc">'_JEXEC'</font><strong>)&nbsp;</strong>or&nbsp;die<strong>(</strong><font color="#66cccc">'Restricted&nbsp;access'</font><strong>)</strong><strong>;</strong></div></li>
<li><div class="src-line"><a name="a3"></a>&nbsp;</div></li>
<li><div class="src-line"><a name="a4"></a><font color="blue">class&nbsp;</font><a href="../default/collector1ModelOrders.html">collector1ModelOrders</a>&nbsp;<font color="blue">extends&nbsp;</font>JModel</div></li>
<li><div class="src-line"><a name="a5"></a><strong>{&nbsp;&nbsp;&nbsp;&nbsp;</strong></div></li>
<li><div class="src-line"><a name="a6"></a>&nbsp;&nbsp;&nbsp;&nbsp;<font color="blue">protected&nbsp;</font><a href="../default/collector1ModelOrders.html#var$default_table">$default_table</a>=<font color="#66cccc">'#__webapps_customer_orders'</font><strong>;</strong></div></li>
<li><div class="src-line"><a name="a7"></a>&nbsp;&nbsp;&nbsp;&nbsp;<font color="#009999">/**</font></div></li>
<li><div class="src-line"><a name="a8"></a><font color="#009999">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;Удалить&nbsp;заказ&nbsp;(файлы&nbsp;к&nbsp;этому&nbsp;моменту&nbsp;уже&nbsp;должны&nbsp;быть&nbsp;удалены&nbsp;методом&nbsp;SFiles::deleteObjectFiles())</font></div></li>
<li><div class="src-line"><a name="a9"></a><font color="#009999">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*/</font></div></li>
<li><div class="src-line"><a name="a10"></a>&nbsp;&nbsp;&nbsp;&nbsp;<font color="blue">function&nbsp;</font><a href="../default/collector1ModelOrders.html#methoddeleteOrder">deleteOrder</a><strong>(</strong><strong>$order_id</strong><strong>,&nbsp;</strong><strong>$table</strong>=false<strong>)</strong><strong>{</strong></div></li>
<li><div class="src-line"><a name="a11"></a>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="green">//удаляем&nbsp;все&nbsp;файлы:</font></div></li>
<li><div class="src-line"><a name="a12"></a>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="blue">if&nbsp;</font><strong>(</strong><strong>$arrUserFiles</strong>=SFiles<strong>::</strong>requestUserFilesByObjectId<strong>(</strong><font color="#66cccc">'orders_ids'</font><strong>,</strong><strong>$order_id</strong><strong>))&nbsp;</strong><strong>{</strong></div></li>
<li><div class="src-line"><a name="a13"></a>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;SFiles<strong>::</strong>deleteObjectFiles<strong>(</strong><strong>$arrUserFiles</strong><strong>,</strong><font color="#66cccc">'o'</font>.<strong>$order_id</strong><strong>)</strong><strong>;&nbsp;</strong><font color="green">//&nbsp;если&nbsp;передан&nbsp;параметр&nbsp;URL&nbsp;test,&nbsp;вместо&nbsp;удаления&nbsp;файлов&nbsp;будет&nbsp;выведено&nbsp;сообщение&nbsp;</font></div></li>
<li><div class="src-line"><a name="a14"></a>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<strong>}</strong></div></li>
<li><div class="src-line"><a name="a15"></a>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<strong>$user&nbsp;</strong>=&nbsp;JFactory<strong>::</strong>getUser<strong>(</strong><strong>)</strong><strong>;</strong></div></li>
<li><div class="src-line"><a name="a16"></a>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="green">//удаляем&nbsp;все&nbsp;записи&nbsp;из&nbsp;таблиц:</font></div></li>
<li><div class="src-line"><a name="a17"></a>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="blue">if&nbsp;</font><strong>(</strong><strong>$user</strong><strong>-&gt;</strong>get<strong>(</strong><font color="#66cccc">'guest'</font><strong>)</strong>==1<strong>)&nbsp;</strong><strong>{&nbsp;</strong><font color="green">//&nbsp;обновить&nbsp;запись&nbsp;в&nbsp;#__webapps_precustomers</font></div></li>
<li><div class="src-line"><a name="a18"></a>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="green">//&nbsp;При&nbsp;передаче&nbsp;тестового&nbsp;параметра&nbsp;(test)&nbsp;в&nbsp;URL&nbsp;выводит&nbsp;сообщение&nbsp;в&nbsp;методе&nbsp;store()&nbsp;вместо&nbsp;выполнения&nbsp;реального&nbsp;действия&nbsp;с&nbsp;таблицей:</font></div></li>
<li><div class="src-line"><a name="a19"></a>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;SCollection<strong>::</strong>deletePrecustomerObject<strong>(</strong><font color="#66cccc">'orders_ids'</font><strong>,</strong><strong>$order_id</strong><strong>)</strong><strong>;</strong></div></li>
<li><div class="src-line"><a name="a20"></a>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<strong>}</strong></div></li>
<li><div class="src-line"><a name="a21"></a>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="green">//&nbsp;удалить&nbsp;запись&nbsp;из&nbsp;#__webapps_customer_orders</font></div></li>
<li><div class="src-line"><a name="a22"></a>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="green">/*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ВНИМАНИЕ!&nbsp;</font></div></li>
<li><div class="src-line"><a name="a23"></a><font color="green">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;@&nbsp;&nbsp;&nbsp;&nbsp;Процедура&nbsp;удаления&nbsp;записи&nbsp;из&nbsp;таблицы&nbsp;customer_orders&nbsp;для&nbsp;коллекций&nbsp;вызывается&nbsp;иначе,&nbsp;из&nbsp;собственного&nbsp;контроллера.</font></div></li>
<li><div class="src-line"><a name="a24"></a><font color="green">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;@&nbsp;&nbsp;&nbsp;&nbsp;Здесь&nbsp;вызов&nbsp;из&nbsp;модели&nbsp;обусловлен&nbsp;тем,&nbsp;что&nbsp;процедура&nbsp;выполняется&nbsp;ТОЛЬКО&nbsp;через&nbsp;AJAX,&nbsp;для&nbsp;которого&nbsp;создан&nbsp;отельный&nbsp;компонент,&nbsp;т.о.,&nbsp;вызов&nbsp;контроллера&nbsp;основного&nbsp;компонента&nbsp;-&nbsp;Controller1&nbsp;-&nbsp;здесь&nbsp;не&nbsp;нужен.</font></div></li>
<li><div class="src-line"><a name="a25"></a><font color="green">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*/</font></div></li>
<li><div class="src-line"><a name="a26"></a>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="blue">if&nbsp;</font><strong>(</strong><strong>!</strong><strong>$table</strong><strong>)&nbsp;</strong><strong>$table&nbsp;</strong>=&nbsp;JTable<strong>::</strong>getInstance<strong>(</strong><font color="#66cccc">'customer_orders'</font><strong>,&nbsp;</strong><font color="#66cccc">'Collector1Table'</font><strong>)</strong><strong>;</strong></div></li>
<li><div class="src-line"><a name="a27"></a>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="green">//удалить&nbsp;из&nbsp;таблицы&nbsp;заказов:</font></div></li>
<li><div class="src-line"><a name="a28"></a>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</div></li>
<li><div class="src-line"><a name="a29"></a>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="green">//&nbsp;При&nbsp;передаче&nbsp;тестового&nbsp;параметра&nbsp;(test)&nbsp;в&nbsp;URL&nbsp;выводит&nbsp;сообщение&nbsp;в&nbsp;методе&nbsp;store()&nbsp;вместо&nbsp;выполнения&nbsp;реального&nbsp;действия&nbsp;с&nbsp;таблицей:</font></div></li>
<li><div class="src-line"><a name="a30"></a>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="blue">if&nbsp;</font><strong>(</strong><strong>!</strong><strong>$table</strong><strong>-&gt;</strong>delete<strong>(</strong><strong>$order_id</strong><strong>))&nbsp;</strong>die<strong>(</strong><font color="#66cccc">&quot;ОШИБКА&nbsp;удаления&nbsp;записи&nbsp;из&nbsp;таблицы&nbsp;заказов!&lt;HR&gt;&quot;</font>.<strong>$table</strong><strong>-&gt;</strong>getError<strong>(</strong><strong>))</strong><strong>;</strong></div></li>
<li><div class="src-line"><a name="a31"></a>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;SFiles<strong>::</strong>deleteFilesRecords<strong>(</strong><font color="#66cccc">'o'</font>.<strong>$order_id</strong><strong>)</strong><strong>;&nbsp;</strong><font color="green">//удалить&nbsp;записи&nbsp;файлов&nbsp;из&nbsp;таблицы&nbsp;#__webapps_files_names</font></div></li>
<li><div class="src-line"><a name="a32"></a>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="blue">return&nbsp;</font>true<strong>;</strong></div></li>
<li><div class="src-line"><a name="a33"></a>&nbsp;&nbsp;&nbsp;&nbsp;<strong>}</strong></div></li>
<li><div class="src-line"><a name="a34"></a>&nbsp;&nbsp;&nbsp;&nbsp;<font color="#009999">/**</font></div></li>
<li><div class="src-line"><a name="a35"></a><font color="#009999">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;Получить&nbsp;список&nbsp;текущих&nbsp;компонентов</font></div></li>
<li><div class="src-line"><a name="a36"></a><font color="#009999">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*/</font></div></li>
<li><div class="src-line"><a name="a37"></a>&nbsp;&nbsp;&nbsp;&nbsp;<font color="blue">function&nbsp;</font><a href="../default/collector1ModelOrders.html#methodgetComponentsNames">getComponentsNames</a><strong>(</strong><strong>)</strong><strong>{</strong></div></li>
<li><div class="src-line"><a name="a38"></a>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<strong>$db</strong>=JFactory<strong>::</strong>getDBO<strong>(</strong><strong>)</strong><strong>;</strong></div></li>
<li><div class="src-line"><a name="a39"></a>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="green">//в&nbsp;качестве&nbsp;альтернативы&nbsp;к&nbsp;нескольким&nbsp;процедурам&nbsp;РНР&nbsp;можно&nbsp;использовать&nbsp;обработку&nbsp;данных&nbsp;на&nbsp;сервере&nbsp;в&nbsp;виде&nbsp;ROUTINE&nbsp;or&nbsp;VIEW.&nbsp;</font></div></li>
<li><div class="src-line"><a name="a40"></a>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="green">//VIEW:</font></div></li>
<li><div class="src-line"><a name="a41"></a><font color="green">/*DROP&nbsp;TEMPORARY&nbsp;TABLE&nbsp;IF&nbsp;EXISTS&nbsp;tbl_name0;</font></div></li>
<li><div class="src-line"><a name="a42"></a>&nbsp;</div></li>
<li><div class="src-line"><a name="a43"></a><font color="green">CREATE&nbsp;TEMPORARY&nbsp;TABLE&nbsp;`tbl_name0`&nbsp;</font></div></li>
<li><div class="src-line"><a name="a44"></a>&nbsp;</div></li>
<li><div class="src-line"><a name="a45"></a><font color="green">SELECT&nbsp;dnior_webapps_site_options.id&nbsp;AS&nbsp;option_id,&nbsp;</font></div></li>
<li><div class="src-line"><a name="a46"></a><font color="green">IF&nbsp;(&nbsp;sites_types_ids_location,</font></div></li>
<li><div class="src-line"><a name="a47"></a><font color="green">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;sites_types_ids_location,</font></div></li>
<li><div class="src-line"><a name="a48"></a><font color="green">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;0&nbsp;--&nbsp;для&nbsp;корректной&nbsp;сортировки&nbsp;результатов&nbsp;внутри&nbsp;таблицы</font></div></li>
<li><div class="src-line"><a name="a49"></a><font color="green">&nbsp;&nbsp;&nbsp;)&nbsp;as&nbsp;`site&nbsp;types`,</font></div></li>
<li><div class="src-line"><a name="a50"></a><font color="green">&nbsp;&nbsp;&nbsp;(&nbsp;select&nbsp;name_ru&nbsp;FROM&nbsp;dnior_webapps_site_options_group&nbsp;</font></div></li>
<li><div class="src-line"><a name="a51"></a><font color="green">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;WHERE&nbsp;site_options_ids&nbsp;</font></div></li>
<li><div class="src-line"><a name="a52"></a><font color="green">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;REGEXP&nbsp;CONCAT('(^|,)',dnior_webapps_site_options.id,'(,|$)')</font></div></li>
<li><div class="src-line"><a name="a53"></a><font color="green">&nbsp;&nbsp;&nbsp;)&nbsp;as&nbsp;`name_ru`,&nbsp;</font></div></li>
<li><div class="src-line"><a name="a54"></a><font color="green">dnior_webapps_site_options.name_ru&nbsp;AS&nbsp;`option`&nbsp;</font></div></li>
<li><div class="src-line"><a name="a55"></a><font color="green">&nbsp;&nbsp;&nbsp;&nbsp;FROM&nbsp;dnior_webapps_site_options&nbsp;</font></div></li>
<li><div class="src-line"><a name="a56"></a><font color="green">&nbsp;&nbsp;&nbsp;&nbsp;LEFT&nbsp;JOIN&nbsp;dnior_webapps_site_options_partial&nbsp;</font></div></li>
<li><div class="src-line"><a name="a57"></a><font color="green">&nbsp;&nbsp;&nbsp;&nbsp;ON&nbsp;dnior_webapps_site_options_partial.site_option_id&nbsp;=&nbsp;dnior_webapps_site_options.id</font></div></li>
<li><div class="src-line"><a name="a58"></a><font color="green">&nbsp;WHERE&nbsp;dnior_webapps_site_options.name_ru&nbsp;&lt;&gt;&nbsp;'Дополнительно'&nbsp;</font></div></li>
<li><div class="src-line"><a name="a59"></a><font color="green">&nbsp;&nbsp;&nbsp;&nbsp;AND&nbsp;dnior_webapps_site_options.id&nbsp;NOT&nbsp;IN&nbsp;(</font></div></li>
<li><div class="src-line"><a name="a60"></a><font color="green">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;SELECT&nbsp;dnior_webapps_site_options.id&nbsp;</font></div></li>
<li><div class="src-line"><a name="a61"></a><font color="green">&nbsp;&nbsp;FROM&nbsp;dnior_webapps_site_options,&nbsp;</font></div></li>
<li><div class="src-line"><a name="a62"></a><font color="green">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;dnior_webapps_site_types,&nbsp;</font></div></li>
<li><div class="src-line"><a name="a63"></a><font color="green">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;dnior_webapps_site_options_partial</font></div></li>
<li><div class="src-line"><a name="a64"></a><font color="green">&nbsp;WHERE&nbsp;dnior_webapps_site_types.name_en&nbsp;=&nbsp;'WebShop'</font></div></li>
<li><div class="src-line"><a name="a65"></a><font color="green">&nbsp;&nbsp;&nbsp;AND&nbsp;dnior_webapps_site_options_partial.id&nbsp;=&nbsp;dnior_webapps_site_options_partial.sites_types_ids_location</font></div></li>
<li><div class="src-line"><a name="a66"></a><font color="green">&nbsp;&nbsp;&nbsp;AND&nbsp;dnior_webapps_site_options.id&nbsp;IN&nbsp;(</font></div></li>
<li><div class="src-line"><a name="a67"></a><font color="green">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;SELECT&nbsp;site_option_id&nbsp;</font></div></li>
<li><div class="src-line"><a name="a68"></a><font color="green">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;FROM&nbsp;dnior_webapps_site_options_partial</font></div></li>
<li><div class="src-line"><a name="a69"></a><font color="green">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;WHERE&nbsp;sites_types_ids_location&nbsp;=&nbsp;(</font></div></li>
<li><div class="src-line"><a name="a70"></a><font color="green">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;SELECT&nbsp;id&nbsp;</font></div></li>
<li><div class="src-line"><a name="a71"></a><font color="green">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;FROM&nbsp;dnior_webapps_site_types&nbsp;</font></div></li>
<li><div class="src-line"><a name="a72"></a><font color="green">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;WHERE&nbsp;name_en&nbsp;=&nbsp;'WebShop'</font></div></li>
<li><div class="src-line"><a name="a73"></a><font color="green">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)</font></div></li>
<li><div class="src-line"><a name="a74"></a><font color="green">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)</font></div></li>
<li><div class="src-line"><a name="a75"></a><font color="green">&nbsp;&nbsp;&nbsp;&nbsp;)&nbsp;ORDER&nbsp;BY&nbsp;`option`&nbsp;ASC;</font></div></li>
<li><div class="src-line"><a name="a76"></a>&nbsp;</div></li>
<li><div class="src-line"><a name="a77"></a><font color="green">DROP&nbsp;TEMPORARY&nbsp;TABLE&nbsp;IF&nbsp;EXISTS&nbsp;tbl_name1&nbsp;;</font></div></li>
<li><div class="src-line"><a name="a78"></a>&nbsp;</div></li>
<li><div class="src-line"><a name="a79"></a><font color="green">CREATE&nbsp;TEMPORARY&nbsp;TABLE&nbsp;`tbl_name1`&nbsp;</font></div></li>
<li><div class="src-line"><a name="a80"></a><font color="green">&nbsp;SELECT&nbsp;*&nbsp;FROM&nbsp;tbl_name0&nbsp;where&nbsp;name_ru&nbsp;IS&nbsp;NULL</font></div></li>
<li><div class="src-line"><a name="a81"></a><font color="green">&nbsp;UNION</font></div></li>
<li><div class="src-line"><a name="a82"></a><font color="green">&nbsp;SELECT&nbsp;0&nbsp;as&nbsp;option_id,&nbsp;0&nbsp;as&nbsp;site_types,&nbsp;0&nbsp;as&nbsp;name_ru,&nbsp;`name_ru`&nbsp;AS&nbsp;`option`&nbsp;FROM&nbsp;dnior_webapps_site_options_group&nbsp;GROUP&nbsp;BY&nbsp;site_options_ids;</font></div></li>
<li><div class="src-line"><a name="a83"></a>&nbsp;</div></li>
<li><div class="src-line"><a name="a84"></a><font color="green">SELECT&nbsp;option_id,&nbsp;`option`&nbsp;AS&nbsp;`component`&nbsp;FROM&nbsp;tbl_name1&nbsp;ORDER&nbsp;BY&nbsp;`option`*/&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font></div></li>
<li><div class="src-line"><a name="a85"></a>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</div></li>
<li><div class="src-line"><a name="a86"></a>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="green">//получить&nbsp;id&nbsp;id&nbsp;опций&nbsp;в&nbsp;группах,&nbsp;чтобы&nbsp;исключить&nbsp;их&nbsp;из&nbsp;списка&nbsp;и&nbsp;показывать&nbsp;вместо&nbsp;них&nbsp;заголовки&nbsp;групп</font></div></li>
<li><div class="src-line"><a name="a87"></a>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="green">//платежи&nbsp;онлайн,&nbsp;виджеты:</font></div></li>
<li><div class="src-line"><a name="a88"></a>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<strong>$db</strong><strong>-&gt;</strong>setQuery<strong>(</strong><font color="#66cccc">'SELECT&nbsp;site_options_ids&nbsp;FROM&nbsp;#__webapps_site_options_group'</font><strong>)</strong><strong>;</strong></div></li>
<li><div class="src-line"><a name="a89"></a>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<strong>$opts</strong>=<a href="http://www.php.net/implode">implode</a><strong>(</strong><font color="#66cccc">','</font><strong>,</strong><strong>$db</strong><strong>-&gt;</strong>loadResultArray<strong>(</strong><strong>))</strong><strong>;</strong></div></li>
<li><div class="src-line"><a name="a90"></a>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="green">//1,3,5,8</font></div></li>
<li><div class="src-line"><a name="a91"></a>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="green">//2,9,6</font></div></li>
<li><div class="src-line"><a name="a92"></a>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="green">//опции&nbsp;интернет-магазина:&nbsp;&nbsp;&nbsp;&nbsp;</font></div></li>
<li><div class="src-line"><a name="a93"></a>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<strong>$query</strong>=<font color="#66cccc">&quot;SELECT&nbsp;#__webapps_site_options.id&nbsp;</font></div></li>
<li><div class="src-line"><a name="a94"></a><font color="#66cccc">&nbsp;&nbsp;FROM&nbsp;#__webapps_site_options,&nbsp;</font></div></li>
<li><div class="src-line"><a name="a95"></a><font color="#66cccc">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#__webapps_site_types,&nbsp;</font></div></li>
<li><div class="src-line"><a name="a96"></a><font color="#66cccc">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#__webapps_site_options_partial</font></div></li>
<li><div class="src-line"><a name="a97"></a><font color="#66cccc">&nbsp;WHERE&nbsp;#__webapps_site_types.name_en&nbsp;=&nbsp;'WebShop'</font></div></li>
<li><div class="src-line"><a name="a98"></a><font color="#66cccc">&nbsp;&nbsp;&nbsp;AND&nbsp;#__webapps_site_options_partial.id&nbsp;=&nbsp;#__webapps_site_options_partial.sites_types_ids_location</font></div></li>
<li><div class="src-line"><a name="a99"></a><font color="#66cccc">&nbsp;&nbsp;&nbsp;AND&nbsp;#__webapps_site_options.id&nbsp;IN&nbsp;(</font></div></li>
<li><div class="src-line"><a name="a100"></a><font color="#66cccc">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;SELECT&nbsp;site_option_id&nbsp;</font></div></li>
<li><div class="src-line"><a name="a101"></a><font color="#66cccc">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;FROM&nbsp;#__webapps_site_options_partial</font></div></li>
<li><div class="src-line"><a name="a102"></a><font color="#66cccc">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;WHERE&nbsp;sites_types_ids_location&nbsp;=&nbsp;(</font></div></li>
<li><div class="src-line"><a name="a103"></a><font color="#66cccc">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;SELECT&nbsp;id&nbsp;</font></div></li>
<li><div class="src-line"><a name="a104"></a><font color="#66cccc">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;FROM&nbsp;#__webapps_site_types&nbsp;</font></div></li>
<li><div class="src-line"><a name="a105"></a><font color="#66cccc">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;WHERE&nbsp;name_en&nbsp;=&nbsp;'WebShop'</font></div></li>
<li><div class="src-line"><a name="a106"></a><font color="#66cccc">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)</font></div></li>
<li><div class="src-line"><a name="a107"></a><font color="#66cccc">&nbsp;&nbsp;&nbsp;&nbsp;)&quot;</font><strong>;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</strong></div></li>
<li><div class="src-line"><a name="a108"></a>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<strong>$db</strong><strong>-&gt;</strong>setQuery<strong>(</strong><strong>$query</strong><strong>)</strong><strong>;</strong></div></li>
<li><div class="src-line"><a name="a109"></a>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<strong>$opts2</strong>=<a href="http://www.php.net/implode">implode</a><strong>(</strong><font color="#66cccc">','</font><strong>,</strong><strong>$db</strong><strong>-&gt;</strong>loadResultArray<strong>(</strong><strong>))</strong><strong>;</strong></div></li>
<li><div class="src-line"><a name="a110"></a>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="green">//объединить&nbsp;исключаемые&nbsp;опции:</font></div></li>
<li><div class="src-line"><a name="a111"></a>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="blue">if&nbsp;</font><strong>(</strong><strong>$opts</strong>&amp;&amp;<strong>$opts2</strong><strong>)&nbsp;</strong><strong>$opts</strong>.=<font color="#66cccc">','</font>.<strong>$opts2</strong><strong>;</strong></div></li>
<li><div class="src-line"><a name="a112"></a>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;else&nbsp;<strong>$opts</strong>=<strong>(</strong><strong>$opts2</strong><strong>)</strong>?&nbsp;<strong>$opts2</strong>:<strong>$opts2</strong><strong>;</strong></div></li>
<li><div class="src-line"><a name="a113"></a>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="blue">if&nbsp;</font><strong>(</strong><strong>$opts</strong><strong>)</strong><strong>{</strong></div></li>
<li><div class="src-line"><a name="a114"></a>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="green">//получить&nbsp;оставшиеся:</font></div></li>
<li><div class="src-line"><a name="a115"></a>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<strong>$query</strong>=<font color="#66cccc">'SELECT&nbsp;id,&nbsp;name_ru&nbsp;FROM&nbsp;#__webapps_site_options</font></div></li>
<li><div class="src-line"><a name="a116"></a><font color="#66cccc">&nbsp;&nbsp;&nbsp;&nbsp;WHERE&nbsp;option_stat&nbsp;=&nbsp;1&nbsp;AND&nbsp;id&nbsp;NOT&nbsp;IN&nbsp;('</font>.<strong>$opts</strong>.<font color="#66cccc">')'</font><strong>;</strong></div></li>
<li><div class="src-line"><a name="a117"></a>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<strong>$db</strong><strong>-&gt;</strong>setQuery<strong>(</strong><strong>$query</strong><strong>)</strong><strong>;</strong></div></li>
<li><div class="src-line"><a name="a118"></a>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<strong>$arrOptions</strong>=<strong>$db</strong><strong>-&gt;</strong>loadAssocList<strong>(</strong><strong>)</strong><strong>;</strong></div></li>
<li><div class="src-line"><a name="a119"></a>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<strong>}&nbsp;</strong></div></li>
<li><div class="src-line"><a name="a120"></a>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<strong>$db</strong><strong>-&gt;</strong>setQuery<strong>(</strong><font color="#66cccc">'SELECT&nbsp;id&nbsp;AS&nbsp;group_id,&nbsp;name_ru&nbsp;FROM&nbsp;#__webapps_site_options_group'</font><strong>)</strong><strong>;</strong></div></li>
<li><div class="src-line"><a name="a121"></a>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<strong>$groups</strong>=<strong>$db</strong><strong>-&gt;</strong>loadAssocList<strong>(</strong><strong>)</strong><strong>;</strong></div></li>
<li><div class="src-line"><a name="a122"></a>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="blue">if&nbsp;</font><strong>(</strong><strong>!</strong><a href="http://www.php.net/is_array">is_array</a><strong>(</strong><strong>$arrOptions</strong><strong>))&nbsp;</strong><strong>$arrOptions</strong>=<strong>$groups</strong><strong>;</strong></div></li>
<li><div class="src-line"><a name="a123"></a>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;else&nbsp;<strong>$arrOptions</strong>=<a href="http://www.php.net/array_merge">array_merge</a><strong>(</strong><strong>$arrOptions</strong><strong>,</strong><strong>$groups</strong><strong>)</strong><strong>;</strong></div></li>
<li><div class="src-line"><a name="a124"></a>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="blue">return&nbsp;</font><strong>$arrOptions</strong><strong>;&nbsp;</strong></div></li>
<li><div class="src-line"><a name="a125"></a>&nbsp;&nbsp;&nbsp;&nbsp;<strong>}</strong></div></li>
<li><div class="src-line"><a name="a126"></a>&nbsp;&nbsp;&nbsp;&nbsp;<font color="#009999">/**</font></div></li>
<li><div class="src-line"><a name="a127"></a><font color="#009999">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;получим&nbsp;заказы&nbsp;зарегистрированного&nbsp;юзера&nbsp;(все&nbsp;данные):</font></div></li>
<li><div class="src-line"><a name="a128"></a><font color="#009999">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;user,&nbsp;customer,&nbsp;precustomer,&nbsp;orders</font></div></li>
<li><div class="src-line"><a name="a129"></a><font color="#009999">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*/</font></div></li>
<li><div class="src-line"><a name="a130"></a>&nbsp;&nbsp;&nbsp;&nbsp;<font color="blue">function&nbsp;</font><a href="../default/collector1ModelOrders.html#methodgetCustomerOrders">getCustomerOrders</a><strong>(</strong><strong>$user&nbsp;</strong>=&nbsp;false<strong>,&nbsp;</strong><strong>$db&nbsp;</strong>=&nbsp;false<strong>,&nbsp;</strong><strong>$order_id&nbsp;</strong>=&nbsp;false<strong>)</strong><strong>{</strong></div></li>
<li><div class="src-line"><a name="a131"></a>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="blue">if&nbsp;</font><strong>(</strong><strong>!</strong><strong>$user</strong><strong>)&nbsp;</strong><strong>$user&nbsp;</strong>=&nbsp;JFactory<strong>::</strong>getUser<strong>(</strong><strong>)</strong><strong>;&nbsp;</strong><font color="green">//var_dump(&quot;&lt;h1&gt;user:&lt;/h1&gt;&lt;pre&gt;&quot;,$user,&quot;&lt;/pre&gt;&quot;);&nbsp;//die();</font></div></li>
<li><div class="src-line"><a name="a132"></a>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="blue">if&nbsp;</font><strong>(</strong><strong>$order_id</strong><strong>)&nbsp;</strong><strong>{</strong></div></li>
<li><div class="src-line"><a name="a133"></a>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<strong>$where</strong>=<font color="#66cccc">&quot;#__webapps_customer_orders.id&nbsp;=&nbsp;&quot;</font>.<strong>$order_id</strong><strong>;</strong></div></li>
<li><div class="src-line"><a name="a134"></a>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<strong>}</strong>else<strong>{</strong></div></li>
<li><div class="src-line"><a name="a135"></a>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="blue">if&nbsp;</font><strong>(</strong><strong>$user</strong><strong>-&gt;</strong>get<strong>(</strong><font color="#66cccc">'guest'</font><strong>)</strong>!=1<strong>)&nbsp;</strong><strong>{</strong></div></li>
<li><div class="src-line"><a name="a136"></a>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<strong>$where</strong>=<font color="#66cccc">&quot;customer_id&nbsp;=&nbsp;&quot;</font>.<strong>$user</strong><strong>-&gt;</strong>get<strong>(</strong><font color="#66cccc">'id'</font><strong>)</strong><strong>;</strong></div></li>
<li><div class="src-line"><a name="a137"></a>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<strong>}</strong>else<strong>{</strong></div></li>
<li><div class="src-line"><a name="a138"></a>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<strong>$where</strong>=<font color="#66cccc">&quot;`email`&nbsp;=&nbsp;'&quot;</font>.<strong>$user</strong><strong>-&gt;</strong>get<strong>(</strong><font color="#66cccc">'email'</font><strong>)</strong>.<font color="#66cccc">&quot;'&nbsp;OR&nbsp;session_id&nbsp;=&nbsp;'&quot;</font>.<a href="http://www.php.net/session_id">session_id</a><strong>(</strong><strong>)</strong>.<font color="#66cccc">&quot;'&quot;</font><strong>;&nbsp;</strong></div></li>
<li><div class="src-line"><a name="a139"></a>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<strong>}&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</strong></div></li>
<li><div class="src-line"><a name="a140"></a>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<strong>$where</strong>.=<font color="#66cccc">&quot;</font></div></li>
<li><div class="src-line"><a name="a141"></a><font color="#66cccc">ORDER&nbsp;BY&nbsp;#__webapps_customer_orders.id&nbsp;DESC&quot;</font><strong>;&nbsp;&nbsp;&nbsp;&nbsp;</strong></div></li>
<li><div class="src-line"><a name="a142"></a>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<strong>}</strong></div></li>
<li><div class="src-line"><a name="a143"></a>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<strong>$query</strong>=<font color="#66cccc">&quot;SELECT&nbsp;&quot;</font>.<strong>$this</strong><strong>-&gt;</strong><a href="../default/collector1ModelOrders.html#var$default_table">default_table</a>.<font color="#66cccc">&quot;.id,&nbsp;</font></div></li>
<li><div class="src-line"><a name="a144"></a><font color="#66cccc">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;components_names,</font></div></li>
<li><div class="src-line"><a name="a145"></a><font color="#66cccc">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;files_names,</font></div></li>
<li><div class="src-line"><a name="a146"></a><font color="#66cccc">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;description,</font></div></li>
<li><div class="src-line"><a name="a147"></a><font color="#66cccc">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;budget,</font></div></li>
<li><div class="src-line"><a name="a148"></a><font color="#66cccc">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;finish_date</font></div></li>
<li><div class="src-line"><a name="a149"></a><font color="#66cccc">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;FROM&nbsp;&quot;</font>.<strong>$this</strong><strong>-&gt;</strong><a href="../default/collector1ModelOrders.html#var$default_table">default_table</a><strong>;</strong></div></li>
<li><div class="src-line"><a name="a150"></a>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="blue">if&nbsp;</font><strong>(</strong><strong>$user</strong><strong>-&gt;</strong>get<strong>(</strong><font color="#66cccc">'guest'</font><strong>)</strong>==1<strong>)</strong><strong>{</strong></div></li>
<li><div class="src-line"><a name="a151"></a>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<strong>$query</strong>.=<font color="#66cccc">&quot;</font></div></li>
<li><div class="src-line"><a name="a152"></a><font color="#66cccc">&nbsp;&nbsp;JOIN&nbsp;#__webapps_precustomers</font></div></li>
<li><div class="src-line"><a name="a153"></a><font color="#66cccc">&nbsp;&nbsp;&nbsp;&nbsp;ON&nbsp;orders_ids&nbsp;REGEXP&nbsp;CONCAT('(^|,)',&quot;</font>.<strong>$this</strong><strong>-&gt;</strong><a href="../default/collector1ModelOrders.html#var$default_table">default_table</a>.<font color="#66cccc">&quot;.id,'(,|$)')&quot;</font><strong>;</strong></div></li>
<li><div class="src-line"><a name="a154"></a>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<strong>}</strong></div></li>
<li><div class="src-line"><a name="a155"></a>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<strong>$query</strong>.=<font color="#66cccc">&quot;&nbsp;&nbsp;</font></div></li>
<li><div class="src-line"><a name="a156"></a><font color="#66cccc">&nbsp;&nbsp;LEFT&nbsp;JOIN&nbsp;#__webapps_files_names&nbsp;</font></div></li>
<li><div class="src-line"><a name="a157"></a><font color="#66cccc">&nbsp;&nbsp;ON&nbsp;(&nbsp;</font></div></li>
<li><div class="src-line"><a name="a158"></a><font color="#66cccc">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;dnior_webapps_files_names.identifier&nbsp;=&nbsp;CONCAT('o',dnior_webapps_customer_orders.id)&nbsp;&nbsp;</font></div></li>
<li><div class="src-line"><a name="a159"></a><font color="#66cccc">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;OR</font></div></li>
<li><div class="src-line"><a name="a160"></a><font color="#66cccc">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;dnior_webapps_files_names.identifier&nbsp;=&nbsp;CONCAT('s',dnior_webapps_customer_orders.id)&nbsp;&nbsp;</font></div></li>
<li><div class="src-line"><a name="a161"></a><font color="#66cccc">&nbsp;&nbsp;&nbsp;&nbsp;)</font></div></li>
<li><div class="src-line"><a name="a162"></a><font color="#66cccc">&nbsp;WHERE&nbsp;&quot;</font>.<strong>$where</strong><strong>;</strong></div></li>
<li><div class="src-line"><a name="a163"></a>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="blue">if&nbsp;</font><strong>(</strong><strong>!</strong><strong>$db</strong><strong>)&nbsp;</strong><strong>$db&nbsp;</strong>=&nbsp;JFactory<strong>::</strong>getDBO<strong>(</strong><strong>)</strong><strong>;</strong></div></li>
<li><div class="src-line"><a name="a164"></a>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<strong>$db</strong><strong>-&gt;</strong>setQuery<strong>(</strong><strong>$query</strong><strong>)</strong><strong>;&nbsp;&nbsp;</strong><font color="green">//SDebug::dOutput(&quot;query=&nbsp;$query&quot;,false,true);&nbsp;//die('getPrecustomerSet');</font></div></li>
<li><div class="src-line"><a name="a165"></a>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<strong>$rows</strong>=<strong>$db</strong><strong>-&gt;</strong>loadAssocList<strong>(</strong><strong>)</strong><strong>;</strong></div></li>
<li><div class="src-line"><a name="a166"></a>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="blue">for</font><strong>(</strong><strong>$i</strong>=0<strong>,</strong><strong>$j</strong>=<a href="http://www.php.net/count">count</a><strong>(</strong><strong>$rows</strong><strong>)</strong><strong>;</strong><strong>$i</strong>&lt;<strong>$j</strong><strong>;</strong><strong>$i</strong>++<strong>)&nbsp;</strong><strong>{</strong></div></li>
<li><div class="src-line"><a name="a167"></a>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="blue">if&nbsp;</font><strong>(</strong><strong>$components_names</strong>=<strong>$rows</strong><strong>[</strong><strong>$i</strong><strong>]</strong><strong>[</strong><font color="#66cccc">'components_names'</font><strong>]</strong><strong>)&nbsp;</strong><strong>{</strong></div></li>
<li><div class="src-line"><a name="a168"></a>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<strong>$query_opt</strong>=<font color="#66cccc">&quot;SELECT&nbsp;id,&nbsp;name_ru&nbsp;FROM&nbsp;#__webapps_site_options&nbsp;WHERE&nbsp;name_ru&nbsp;IN&nbsp;('&quot;</font>.<a href="http://www.php.net/str_replace">str_replace</a><strong>(</strong><font color="#66cccc">'|'</font><strong>,</strong><font color="#66cccc">&quot;','&quot;</font><strong>,</strong><strong>$components_names</strong><strong>)</strong>.<font color="#66cccc">&quot;')&quot;</font><strong>;</strong></div></li>
<li><div class="src-line"><a name="a169"></a>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<strong>$db</strong><strong>-&gt;</strong>setQuery<strong>(</strong><strong>$query_opt</strong><strong>)</strong><strong>;</strong></div></li>
<li><div class="src-line"><a name="a170"></a>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<strong>$components</strong>=<strong>$db</strong><strong>-&gt;</strong>loadAssocList<strong>(</strong><strong>)</strong><strong>;</strong></div></li>
<li><div class="src-line"><a name="a171"></a>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<strong>$rows</strong><strong>[</strong><strong>$i</strong><strong>]</strong><strong>[</strong><font color="#66cccc">'components_names'</font><strong>]</strong>=<strong>$components</strong><strong>;</strong></div></li>
<li><div class="src-line"><a name="a172"></a>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<strong>}</strong></div></li>
<li><div class="src-line"><a name="a173"></a>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="blue">if&nbsp;</font><strong>(</strong><strong>$file_name</strong>=<strong>$rows</strong><strong>[</strong><strong>$i</strong><strong>]</strong><strong>[</strong><font color="#66cccc">'files_names'</font><strong>]</strong><strong>)&nbsp;</strong><strong>{</strong></div></li>
<li><div class="src-line"><a name="a174"></a>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<strong>$filenames</strong>=<a href="http://www.php.net/explode">explode</a><strong>(</strong><font color="#66cccc">&quot;:&quot;</font><strong>,</strong><strong>$file_name</strong><strong>)</strong><strong>;&nbsp;</strong><font color="green">//convert&nbsp;to&nbsp;array</font></div></li>
<li><div class="src-line"><a name="a175"></a>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<strong>$rows</strong><strong>[</strong><strong>$i</strong><strong>]</strong><strong>[</strong><font color="#66cccc">'files_names'</font><strong>]</strong>=<strong>$filenames</strong><strong>;</strong></div></li>
<li><div class="src-line"><a name="a176"></a>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<strong>}&nbsp;</strong><font color="green">//&nbsp;SDebug::showDebugContent($rows,'rows');</font></div></li>
<li><div class="src-line"><a name="a177"></a>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<strong>}</strong></div></li>
<li><div class="src-line"><a name="a178"></a>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="blue">return&nbsp;</font><strong>(</strong>empty<strong>(</strong><strong>$rows</strong><strong>))</strong>?&nbsp;false:<strong>$rows</strong><strong>;</strong></div></li>
<li><div class="src-line"><a name="a179"></a>&nbsp;&nbsp;&nbsp;&nbsp;<strong>}</strong></div></li>
<li><div class="src-line"><a name="a180"></a>&nbsp;&nbsp;&nbsp;&nbsp;<font color="#009999">/**</font></div></li>
<li><div class="src-line"><a name="a181"></a><font color="#009999">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;получить&nbsp;id&nbsp;id&nbsp;ЗАКАЗОВ&nbsp;заказчика/предзаказчика</font></div></li>
<li><div class="src-line"><a name="a182"></a><font color="#009999">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;user,&nbsp;orders</font></div></li>
<li><div class="src-line"><a name="a183"></a><font color="#009999">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*/</font></div></li>
<li><div class="src-line"><a name="a184"></a>&nbsp;&nbsp;&nbsp;&nbsp;<font color="green">/*function&nbsp;getUserOrdersIds($user&nbsp;=&nbsp;false,&nbsp;$db&nbsp;=&nbsp;false){</font></div></li>
<li><div class="src-line"><a name="a185"></a><font color="green">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(!$user)&nbsp;$user&nbsp;=&nbsp;JFactory::getUser();</font></div></li>
<li><div class="src-line"><a name="a186"></a><font color="green">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(!$this-&gt;orders_ids_array)&nbsp;{</font></div></li>
<li><div class="src-line"><a name="a187"></a><font color="green">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;($user-&gt;get('guest')==1){&nbsp;//returns&nbsp;string</font></div></li>
<li><div class="src-line"><a name="a188"></a><font color="green">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;SCollection::getPrecustomerSet(&nbsp;'orders_ids',&nbsp;</font></div></li>
<li><div class="src-line"><a name="a189"></a><font color="green">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$user,</font></div></li>
<li><div class="src-line"><a name="a190"></a><font color="green">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;true</font></div></li>
<li><div class="src-line"><a name="a191"></a><font color="green">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;);</font></div></li>
<li><div class="src-line"><a name="a192"></a><font color="green">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}else{&nbsp;//returns&nbsp;string</font></div></li>
<li><div class="src-line"><a name="a193"></a><font color="green">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;SCollection::getUserSet('orders_ids',$user-&gt;get('id'));</font></div></li>
<li><div class="src-line"><a name="a194"></a><font color="green">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</font></div></li>
<li><div class="src-line"><a name="a195"></a><font color="green">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</font></div></li>
<li><div class="src-line"><a name="a196"></a><font color="green">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;$model-&gt;orders_ids_string;</font></div></li>
<li><div class="src-line"><a name="a197"></a><font color="green">&nbsp;&nbsp;&nbsp;&nbsp;}*/</font></div></li>
<li><div class="src-line"><a name="a198"></a>&nbsp;&nbsp;&nbsp;&nbsp;<font color="#009999">/**</font></div></li>
<li><div class="src-line"><a name="a199"></a><font color="#009999">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;размещение/обновление&nbsp;заказа&nbsp;на&nbsp;выполнение&nbsp;отдельного&nbsp;компонента/(ов)</font></div></li>
<li><div class="src-line"><a name="a200"></a><font color="#009999">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;см.&nbsp;/_docs/схемы.xlsx!Работа&nbsp;с&nbsp;файлами&nbsp;заказчиков</font></div></li>
<li><div class="src-line"><a name="a201"></a><font color="#009999">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;model,&nbsp;orders</font></div></li>
<li><div class="src-line"><a name="a202"></a><font color="#009999">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*/</font></div></li>
<li><div class="src-line"><a name="a203"></a>&nbsp;&nbsp;&nbsp;&nbsp;<font color="blue">function&nbsp;</font><a href="../default/collector1ModelOrders.html#methodmakeOrder">makeOrder</a><strong>(</strong><strong>$model</strong><strong>,</strong><strong>$current_order_id</strong>=false<strong>,</strong><strong>$user</strong>=false<strong>)</strong><strong>{</strong></div></li>
<li><div class="src-line"><a name="a204"></a>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<strong>$table&nbsp;</strong>=&nbsp;JTable<strong>::</strong>getInstance<strong>(</strong><font color="#66cccc">'customer_orders'</font><strong>,&nbsp;</strong><font color="#66cccc">'Collector1Table'</font><strong>)</strong><strong>;&nbsp;</strong><font color="green">//создаём&nbsp;запись&nbsp;о&nbsp;новом&nbsp;заказе</font></div></li>
<li><div class="src-line"><a name="a205"></a>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<strong>$table</strong><strong>-&gt;</strong>reset<strong>(</strong><strong>)</strong><strong>;</strong></div></li>
<li><div class="src-line"><a name="a206"></a>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="blue">if&nbsp;</font><strong>(</strong><strong>!</strong><strong>$user</strong><strong>)</strong><strong>{&nbsp;</strong></div></li>
<li><div class="src-line"><a name="a207"></a>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<strong>$user&nbsp;</strong>=&nbsp;JFactory<strong>::</strong>getUser<strong>(</strong><strong>)</strong><strong>;</strong></div></li>
<li><div class="src-line"><a name="a208"></a>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="blue">if</font><strong>(</strong><strong>$user</strong><strong>-&gt;</strong>get<strong>(</strong><font color="#66cccc">'guest'</font><strong>)</strong>!=1<strong>)&nbsp;</strong><strong>$table</strong><strong>-&gt;</strong>set<strong>(</strong><font color="#66cccc">'customer_id'</font><strong>,&nbsp;</strong><strong>$user</strong><strong>-&gt;</strong>get<strong>(</strong><font color="#66cccc">'id'</font><strong>))</strong><strong>;</strong><font color="green">//юзер&nbsp;заавторизован</font></div></li>
<li><div class="src-line"><a name="a209"></a>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<strong>}&nbsp;</strong><font color="green">//die('110');</font></div></li>
<li><div class="src-line"><a name="a210"></a>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<strong>$arrPost</strong>=JRequest<strong>::</strong>get<strong>(</strong><font color="#66cccc">'post'</font><strong>)</strong><strong>;</strong></div></li>
<li><div class="src-line"><a name="a211"></a>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<strong>$arrComponentsNames</strong>=array<strong>(</strong><strong>)</strong><strong>;</strong></div></li>
<li><div class="src-line"><a name="a212"></a>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="blue">foreach&nbsp;</font><strong>(</strong><strong>$arrPost&nbsp;</strong>as&nbsp;<strong>$key</strong>=&gt;<strong>$component_name</strong><strong>)</strong><strong>{</strong></div></li>
<li><div class="src-line"><a name="a213"></a>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="blue">if&nbsp;</font><strong>(</strong><a href="http://www.php.net/strstr">strstr</a><strong>(</strong><strong>$key</strong><strong>,</strong><font color="#66cccc">&quot;component_&quot;</font><strong>))&nbsp;</strong><strong>$arrComponentsNames</strong><strong>[</strong><strong>]</strong>=<strong>$component_name</strong><strong>;</strong></div></li>
<li><div class="src-line"><a name="a214"></a>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<strong>}</strong></div></li>
<li><div class="src-line"><a name="a215"></a>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="green">//имена&nbsp;компонентов:</font></div></li>
<li><div class="src-line"><a name="a216"></a>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="blue">if&nbsp;</font><strong>(</strong><strong>!</strong>empty<strong>(</strong><strong>$arrComponentsNames</strong><strong>))</strong></div></li>
<li><div class="src-line"><a name="a217"></a>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<strong>$table</strong><strong>-&gt;</strong>set<strong>(</strong><font color="#66cccc">'components_names'</font><strong>,&nbsp;</strong><a href="http://www.php.net/implode">implode</a><strong>(</strong><font color="#66cccc">'|'</font><strong>,</strong><strong>$arrComponentsNames</strong><strong>))</strong><strong>;</strong></div></li>
<li><div class="src-line"><a name="a218"></a>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</div></li>
<li><div class="src-line"><a name="a219"></a>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<strong>$table</strong><strong>-&gt;</strong>set<strong>(</strong><font color="#66cccc">'description'</font><strong>,&nbsp;</strong>JRequest<strong>::</strong>getVar<strong>(</strong><font color="#66cccc">'order_description'</font><strong>))</strong><strong>;</strong></div></li>
<li><div class="src-line"><a name="a220"></a>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<strong>$table</strong><strong>-&gt;</strong>set<strong>(</strong><font color="#66cccc">'budget'</font><strong>,&nbsp;</strong>JRequest<strong>::</strong>getVar<strong>(</strong><font color="#66cccc">'budget'</font><strong>))</strong><strong>;</strong></div></li>
<li><div class="src-line"><a name="a221"></a>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<strong>$table</strong><strong>-&gt;</strong>set<strong>(</strong><font color="#66cccc">'finish_date'</font><strong>,&nbsp;</strong>JRequest<strong>::</strong>getVar<strong>(</strong><font color="#66cccc">'finish_date'</font><strong>))</strong><strong>;</strong></div></li>
<li><div class="src-line"><a name="a222"></a>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<strong>$table</strong><strong>-&gt;</strong>set<strong>(</strong><font color="#66cccc">'ordering'</font><strong>,&nbsp;</strong><strong>$table</strong><strong>-&gt;&nbsp;</strong>getNextOrder<strong>(</strong><strong>))</strong><strong>;&nbsp;</strong><font color="green">//die('current_order_id='.$current_order_id);</font></div></li>
<li><div class="src-line"><a name="a223"></a>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="blue">if&nbsp;</font><strong>(</strong><strong>$current_order_id</strong><strong>)</strong><strong>{&nbsp;</strong><font color="green">//если&nbsp;обновляем</font></div></li>
<li><div class="src-line"><a name="a224"></a>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="blue">if&nbsp;</font><strong>(</strong><strong>!</strong><strong>$table</strong><strong>-&gt;</strong>load<strong>(</strong><strong>$current_order_id</strong><strong>))&nbsp;</strong><strong>{</strong></div></li>
<li><div class="src-line"><a name="a225"></a>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;JMail<strong>::</strong>sendErrorMess<strong>(</strong><strong>$table</strong><strong>-&gt;</strong>getError<strong>(</strong><strong>)</strong><strong>,</strong><font color="#66cccc">&quot;&nbsp;(\$table-&gt;load())&quot;</font><strong>)</strong><strong>;</strong></div></li>
<li><div class="src-line"><a name="a226"></a>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<strong>}</strong>else<strong>{&nbsp;</strong><font color="green">//обновить&nbsp;запись&nbsp;в&nbsp;таблице&nbsp;заказов</font></div></li>
<li><div class="src-line"><a name="a227"></a>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;SErrors<strong>::</strong>afterTableUpdate<strong>(&nbsp;</strong><strong>$table</strong><font color="green">/*,</font></div></li>
<li><div class="src-line"><a name="a228"></a><font color="green">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;true,&nbsp;//если&nbsp;передаём&nbsp;true,&nbsp;пропускаем&nbsp;проверку&nbsp;$table-&gt;load($id)&nbsp;внутри</font></div></li>
<li><div class="src-line"><a name="a229"></a><font color="green">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$current_order_id*/</font></div></li>
<li><div class="src-line"><a name="a230"></a>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<strong>)</strong><strong>;</strong></div></li>
<li><div class="src-line"><a name="a231"></a>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<strong>}</strong></div></li>
<li><div class="src-line"><a name="a232"></a>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<strong>}</strong>else<strong>{&nbsp;</strong><font color="green">//добавить&nbsp;запись&nbsp;в&nbsp;таблицу&nbsp;заказов</font></div></li>
<li><div class="src-line"><a name="a233"></a>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;SErrors<strong>::</strong>afterTable<strong>(</strong><strong>$table</strong><strong>)</strong><strong>;</strong></div></li>
<li><div class="src-line"><a name="a234"></a>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<strong>}</strong><font color="green">//die('136');</font></div></li>
<li><div class="src-line"><a name="a235"></a>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<strong>$new_order_record_id</strong>=SData<strong>::</strong>getLastId<strong>(</strong>SCollection<strong>::</strong>getDefaultTable<strong>(</strong>true<strong>))</strong><strong>;&nbsp;</strong><font color="green">//получить&nbsp;id&nbsp;последней&nbsp;записи&nbsp;из&nbsp;таблицы&nbsp;заказов&nbsp;&nbsp;&nbsp;&nbsp;</font></div></li>
<li><div class="src-line"><a name="a236"></a>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<strong>$customer_status</strong>=SUser<strong>::</strong>handleUserData<strong>(</strong>JFactory<strong>::</strong>getUser<strong>(</strong><strong>))</strong><strong>;</strong><font color="green">//назначить&nbsp;данные/получить&nbsp;статус&nbsp;юзера</font></div></li>
<li><div class="src-line"><a name="a237"></a>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;/**</div></li>
<li><div class="src-line"><a name="a238"></a>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;обработка&nbsp;данных&nbsp;таблицы&nbsp;предзаказчиков</div></li>
<li><div class="src-line"><a name="a239"></a>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*/</div></li>
<li><div class="src-line"><a name="a240"></a>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="blue">if&nbsp;</font><strong>(&nbsp;</strong><strong>$customer_status</strong>==<font color="#66cccc">&quot;precustomer&quot;&nbsp;</font>||&nbsp;<font color="green">//предзаказчик,&nbsp;-&nbsp;будем&nbsp;обновлять&nbsp;данные&nbsp;в&nbsp;таблице</font></div></li>
<li><div class="src-line"><a name="a241"></a>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<strong>$customer_status</strong>==<font color="#66cccc">&quot;unknown&quot;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="green">//неизвестен,&nbsp;-&nbsp;будем&nbsp;добавлять&nbsp;данные&nbsp;в&nbsp;таблицу</font></div></li>
<li><div class="src-line"><a name="a242"></a>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<strong>)&nbsp;</strong><strong>{</strong></div></li>
<li><div class="src-line"><a name="a243"></a>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="green">//установить&nbsp;id&nbsp;актуальной&nbsp;записи&nbsp;в&nbsp;таблице&nbsp;предзаказчиков&nbsp;для&nbsp;проверки:</font></div></li>
<li><div class="src-line"><a name="a244"></a>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="green">//последней&nbsp;добавленной&nbsp;в&nbsp;неё&nbsp;</font></div></li>
<li><div class="src-line"><a name="a245"></a>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="green">//получить&nbsp;id&nbsp;записи&nbsp;в&nbsp;таблице&nbsp;предзаказчика,&nbsp;чтобы&nbsp;передать&nbsp;далее&nbsp;для&nbsp;обновления&nbsp;таблицы:&nbsp;&nbsp;&nbsp;</font></div></li>
<li><div class="src-line"><a name="a246"></a>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</div></li>
<li><div class="src-line"><a name="a247"></a>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="green">//if&nbsp;($customer_status==&quot;precustomer&quot;){&nbsp;//предзаказчик</font></div></li>
<li><div class="src-line"><a name="a248"></a>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="green">//$precustomer_table_id=SCollection::getPrecustomerRowID($user);</font></div></li>
<li><div class="src-line"><a name="a249"></a>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="green">//}</font></div></li>
<li><div class="src-line"><a name="a250"></a>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;SUser<strong>::</strong>handlePrecustomersTable<strong>(&nbsp;</strong><font color="green">//добавить&nbsp;запись&nbsp;в&nbsp;таблицу&nbsp;предзаказчиков&nbsp;</font></div></li>
<li><div class="src-line"><a name="a251"></a>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<strong>$customer_status</strong><strong>,</strong><font color="green">//precustomer/unknown</font></div></li>
<li><div class="src-line"><a name="a252"></a>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<strong>$new_order_record_id</strong><strong>,&nbsp;</strong><font color="green">//новая&nbsp;запись&nbsp;в&nbsp;таблице&nbsp;заказов</font></div></li>
<li><div class="src-line"><a name="a253"></a>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#66cccc">'orders_ids'</font><strong>,</strong><font color="green">//Коллекция&nbsp;или&nbsp;Заказ</font></div></li>
<li><div class="src-line"><a name="a254"></a>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<strong>$arrPost</strong><strong>,&nbsp;</strong><font color="green">//массив&nbsp;POST</font></div></li>
<li><div class="src-line"><a name="a255"></a>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#66cccc">'add'</font><strong>,</strong><font color="green">//добавить&nbsp;(или&nbsp;обновить)&nbsp;к&nbsp;набору&nbsp;коллекций/заказов&nbsp;или&nbsp;удалить&nbsp;из&nbsp;него</font></div></li>
<li><div class="src-line"><a name="a256"></a>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<strong>$user</strong></div></li>
<li><div class="src-line"><a name="a257"></a>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<strong>)</strong><strong>;</strong></div></li>
<li><div class="src-line"><a name="a258"></a>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<strong>}&nbsp;</strong><font color="green">//echo&nbsp;&quot;&lt;h4&gt;afterTable&nbsp;START&lt;/h4&gt;&quot;;&nbsp;//die('141');</font></div></li>
<li><div class="src-line"><a name="a259"></a>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;SErrors<strong>::</strong>afterTable<strong>(</strong><strong>$table</strong><strong>)</strong><strong>;&nbsp;</strong><font color="green">//customer_orders</font></div></li>
<li><div class="src-line"><a name="a260"></a>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;SFiles<strong>::</strong>handleFilesUploading<strong>(</strong><font color="#66cccc">'o'</font><strong>,</strong><strong>$new_order_record_id</strong><strong>)</strong><strong>;&nbsp;</strong><font color="green">//die();</font></div></li>
<li><div class="src-line"><a name="a261"></a>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="blue">return&nbsp;</font>true<strong>;</strong></div></li>
<li><div class="src-line"><a name="a262"></a>&nbsp;&nbsp;&nbsp;&nbsp;<strong>}</strong></div></li>
<li><div class="src-line"><a name="a263"></a><strong>}</strong></div></li>
</ol></div>
</div>
	<div id="credit">
		<hr />
		Documentation generated on Sun, 29 Jul 2012 11:23:42 +0400 by <a href="http://www.phpdoc.org" target="_blank">phpDocumentor 1.4.3</a>
	</div>
</body>
</html>